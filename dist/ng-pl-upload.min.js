!function(){"use strict";angular.module("ngPlUpload",[]).directive("ngPlUpload",[function(){return{scope:{ngPlUploadFilesModel:"=",ngPlUploadFiltersModel:"=",ngPlUploadHeadersModel:"=",ngPlUploadInstance:"=",ngPlUploadMultiParamsModel:"=",ngPlUploadProgressModel:"="},link:function(l,n,e){var a,o,p=function(){var l,n,e="",a=5,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(l=0;a>l;l+=1)n=Math.floor(Math.random()*o.length),e+=o.substring(n,n+1);return e};e.id||e.$set("id","ng-pl-upload-"+p()),e.ngPlUploadUrl||e.$set("ngPlUploadUrl","upload.php"),"undefined"==typeof l.ngPlUploadFiltersModel?l.filters=[{title:"Image files",extensions:"jpg,jpeg,gif,png"}]:l.filters=l.ngPlUploadFiltersModel,e.ngPlUploadMaxFileSize||e.$set("ngPlUploadMaxFileSize","10mb"),e.ngPlUploadPreventDuplicates?e.$set("ngPlUploadPreventDuplicates","true"===e.ngPlUploadPreventDuplicates):e.$set("ngPlUploadPreventDuplicates",!1),e.ngPlUploadMaxRetries||e.$set("ngPlUploadMaxRetries",0),e.ngPlUploadChunkSize||e.$set("ngPlUploadChunkSize",0),e.ngPlUploadDropElement||e.$set("ngPlUploadDropElement",!1),e.ngPlUploadMultiSelection?e.$set("ngPlUploadMultiSelection","true"===e.ngPlUploadMultiSelection):e.$set("ngPlUploadMultiSelection",!0),e.ngPlUploadRequiredFeatures||e.$set("ngPlUploadRequiredFeatures",{}),e.ngPlUploadUniqueNames?e.$set("ngPlUploadUniqueNames","true"===e.ngPlUploadUniqueNames):e.$set("ngPlUploadUniqueNames",!1),e.ngPlUploadRuntimes||e.$set("ngPlUploadRuntimes","html5,flash,silverlight,html4"),e.ngPlUploadFileDataName||e.$set("ngPlUploadFileDataName","file"),e.ngPlUploadFlashSwfUrl||e.$set("ngPlUploadFlashSwfUrl","lib/plupload/plupload.flash.swf"),e.ngPlUploadSilverlightXapUrl||e.$set("ngPlUploadSilverlightXapUrl","lib/plupload/plupload.flash.silverlight.xap"),e.ngPlUploadAutoUpload?e.$set("ngPlUploadAutoUpload","true"===e.ngPlUploadAutoUpload):e.$set("ngPlUploadAutoUpload",!0),o={browse_button:e.id,url:e.ngPlUploadUrl,filters:{mime_types:l.filters,max_file_size:e.ngPlUploadMaxFileSize,prevent_duplicates:e.ngPlUploadPreventDuplicates},headers:l.ngPlUploadHeadersModel||null,multipart:null!==l.ngPlUploadMultiParamsModel,multipart_params:l.ngPlUploadMultiParamsModel||null,max_retries:e.ngPlUploadMaxRetries,chunk_size:e.ngPlUploadChunkSize,drop_element:e.ngPlUploadDropElement,multi_selection:e.ngPlUploadMultiSelection,required_features:e.ngPlUploadRequiredFeatures,unique_names:e.ngPlUploadUniqueNames,runtimes:e.ngPlUploadRuntimes,file_data_name:e.ngPlUploadFileDataName,flash_swf_url:e.ngPlUploadFlashSwfUrl,silverlight_xap_url:e.ngPlUploadSilverlightXapUrl},a=new plupload.Uploader(o),a.init(),a.bind("FilesAdded",function(n,o){e.ngPlUploadFilesModel&&l.$apply(function(){angular.forEach(o,function(n){l.ngPlUploadFilesModel.push(n)})}),"true"===e.ngPlUploadAutoUpload&&a.start()}),a.bind("UploadProgress",function(n,a){e.ngPlUploadProgressModel&&(e.ngPlUploadFilesModel?l.$apply(function(){var n=0;angular.forEach(l.ngPlUploadFilesModel,function(l){n+=l.percent}),l.ngPlUploadProgressModel=n/l.ngPlUploadFilesModel.length}):l.$apply(function(){l.ngPlUploadProgressModel=a.percent}))}),e.ngPlInit&&a.bind("Init",function(n){l.$parent.$apply(function(l){l[e.ngPlInit](n)})}),e.ngPlPostInit&&a.bind("PostInit",function(n){l.$parent.$apply(function(l){l[e.ngPlPostInit](n)})}),e.ngPlOptionChanged&&a.bind("OptionChanged",function(n,a,o,p){l.$parent.$apply(function(l){l[e.ngPlOptionChanged](n,a,o,p)})}),e.ngPlRefresh&&a.bind("Refresh",function(n){l.$parent.$apply(function(l){l[e.ngPlRefresh](n)})}),e.ngPlStateChanged&&a.bind("StateChanged",function(n){l.$parent.$apply(function(l){l[e.ngPlStateChanged](n)})}),e.ngPlUploadFile&&a.bind("UploadFile",function(n,a){l.$parent.$apply(function(l){l[e.ngPlUploadFile](n,a)})}),e.ngPlBeforeUpload&&a.bind("BeforeUpload",function(n,a){l.$parent.$apply(function(l){l[e.ngPlBeforeUpload](n,a)})}),e.ngPlQueueChanged&&a.bind("QueueChanged",function(n){l.$parent.$apply(function(l){l[e.ngPlQueueChanged](n)})}),e.ngPlUploadProgress&&a.bind("UploadProgress",function(n,a){l.$parent.$apply(function(l){l[e.ngPlUploadProgress](n,a)})}),e.ngPlFilesRemoved&&a.bind("FilesRemoved",function(n,a){l.$parent.$apply(function(l){l[e.ngPlFilesRemoved](n,a)})}),e.ngPlFileFiltered&&a.bind("FileFiltered",function(n,a){l.$parent.$apply(function(l){l[e.ngPlFileFiltered](n,a)})}),e.ngPlFilesAdded&&a.bind("FilesAdded",function(n,a){l.$parent.$apply(function(l){l[e.ngPlFilesAdded](n,a)})}),e.ngPlFileUploaded&&a.bind("FileUploaded",function(n,a,o){l.$parent.$apply(function(l){l[e.ngPlFileUploaded](n,a,o)})}),e.ngPlChunkUploaded&&a.bind("ChunkUploaded",function(n,a,o){l.$parent.$apply(function(l){l[e.ngPlChunkUploaded](n,a,o)})}),e.ngPlUploadComplete&&a.bind("UploadComplete",function(n,a){l.$parent.$apply(function(l){l[e.ngPlUploadComplete](n,a)})}),e.ngPlUploadError&&a.bind("Error",function(n,a){l.$parent.$apply(function(l){l[e.ngPlUploadError](n,a)})}),e.ngPlUploadInstance&&(l.ngPlUploadInstance=a)}}}])}();
