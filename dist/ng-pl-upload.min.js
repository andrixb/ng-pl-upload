!function(){"use strict";angular.module("ngPlUpload",[]).directive("ngPlUpload",[function(){return{scope:{ngPlUploadFilesModel:"=",ngPlUploadFiltersModel:"=",ngPlUploadHeadersModel:"=",ngPlUploadInstance:"=",ngPlUploadMultiParamsModel:"=",ngPlUploadProgressModel:"="},link:function(a,b,c){var d,e,f=function(){var a,b,c="",d=5,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(a=0;d>a;a+=1)b=Math.floor(Math.random()*e.length),c+=e.substring(b,b+1);return c};c.id||c.$set("id","ng-pl-upload-"+f()),c.ngPlUploadUrl||c.$set("ngPlUploadUrl","upload.php"),a.filters="undefined"==typeof a.ngPlUploadFiltersModel?[{title:"Image files",extensions:"jpg,jpeg,gif,png"}]:a.ngPlUploadFiltersModel,c.ngPlUploadMaxFileSize||c.$set("ngPlUploadMaxFileSize","10mb"),c.ngPlUploadPreventDuplicates||c.$set("ngPlUploadPreventDuplicates",!1),c.ngPlUploadMaxRetries||c.$set("ngPlUploadMaxRetries",0),c.ngPlUploadChunkSize||c.$set("ngPlUploadChunkSize",0),c.ngPlUploadDropElement||c.$set("ngPlUploadDropElement",!1),c.ngPlUploadMultiSelection||c.$set("ngPlUploadMultiSelection",!0),c.ngPlUploadRequiredFeatures||c.$set("ngPlUploadRequiredFeatures",{}),c.ngPlUploadUniqueNames||c.$set("ngPlUploadUniqueNames",!1),c.ngPlUploadRuntimes||c.$set("ngPlUploadRuntimes","html5,flash,silverlight,html4"),c.ngPlUploadFileDataName||c.$set("ngPlUploadFileDataName","file"),c.ngPlUploadFlashSwfUrl||c.$set("ngPlUploadFlashSwfUrl","lib/plupload/plupload.flash.swf"),c.ngPlUploadSilverlightXapUrl||c.$set("ngPlUploadSilverlightXapUrl","lib/plupload/plupload.flash.silverlight.xap"),c.ngPlUploadAutoUpload||c.$set("ngPlUploadAutoUpload",!0),e={browse_button:c.id,url:c.ngPlUploadUrl,filters:{mime_types:a.filters,max_file_size:c.ngPlUploadMaxFileSize,prevent_duplicates:c.ngPlUploadPreventDuplicates},headers:a.ngPlUploadHeadersModel||null,multipart:null!==a.ngPlUploadMultiParamsModel,multipart_params:a.ngPlUploadMultiParamsModel||null,max_retries:c.ngPlUploadMaxRetries,chunk_size:c.ngPlUploadChunkSize,drop_element:c.ngPlUploadDropElement,multi_selection:c.ngPlUploadMultiSelection,required_features:c.ngPlUploadRequiredFeatures,unique_names:c.ngPlUploadUniqueNames,runtimes:c.ngPlUploadRuntimes,file_data_name:c.ngPlUploadFileDataName,flash_swf_url:c.ngPlUploadFlashSwfUrl,silverlight_xap_url:c.ngPlUploadSilverlightXapUrl},d=new plupload.Uploader(e),d.init(),d.bind("FilesAdded",function(b,e){c.ngPlUploadFilesModel&&a.$apply(function(){angular.forEach(e,function(b){a.ngPlUploadFilesModel.push(b)})}),"true"===c.ngPlUploadAutoUpload&&d.start()}),d.bind("UploadProgress",function(b,d){c.ngPlUploadProgressModel&&(c.ngPlUploadFilesModel?a.$apply(function(){var b=0;angular.forEach(a.ngPlUploadFilesModel,function(a){b+=a.percent}),a.ngPlUploadProgressModel=b/a.ngPlUploadFilesModel.length}):a.$apply(function(){a.ngPlUploadProgressModel=d.percent}))}),c.ngPlInit&&d.bind("Init",function(b){a.$parent.$apply(function(a){a[c.ngPlInit](b)})}),c.ngPlPostInit&&d.bind("PostInit",function(b){a.$parent.$apply(function(a){a[c.ngPlPostInit](b)})}),c.ngPlOptionChanged&&d.bind("OptionChanged",function(b,d,e,f){a.$parent.$apply(function(a){a[c.ngPlOptionChanged](b,d,e,f)})}),c.ngPlRefresh&&d.bind("Refresh",function(b){a.$parent.$apply(function(a){a[c.ngPlRefresh](b)})}),c.ngPlStateChanged&&d.bind("StateChanged",function(b){a.$parent.$apply(function(a){a[c.ngPlStateChanged](b)})}),c.ngPlUploadFile&&d.bind("UploadFile",function(b,d){a.$parent.$apply(function(a){a[c.ngPlUploadFile](b,d)})}),c.ngPlBeforeUpload&&d.bind("BeforeUpload",function(b,d){a.$parent.$apply(function(a){a[c.ngPlBeforeUpload](b,d)})}),c.ngPlQueueChanged&&d.bind("QueueChanged",function(b){a.$parent.$apply(function(a){a[c.ngPlQueueChanged](b)})}),c.ngPlUploadProgress&&d.bind("UploadProgress",function(b,d){a.$parent.$apply(function(a){a[c.ngPlUploadProgress](b,d)})}),c.ngPlFilesRemoved&&d.bind("FilesRemoved",function(b,d){a.$parent.$apply(function(a){a[c.ngPlFilesRemoved](b,d)})}),c.ngPlFileFiltered&&d.bind("FileFiltered",function(b,d){a.$parent.$apply(function(a){a[c.ngPlFileFiltered](b,d)})}),c.ngPlFilesAdded&&d.bind("FilesAdded",function(b,d){a.$parent.$apply(function(a){a[c.ngPlFilesAdded](b,d)})}),c.ngPlFileUploaded&&d.bind("FileUploaded",function(b,d,e){a.$parent.$apply(function(a){a[c.ngPlFileUploaded](b,d,e)})}),c.ngPlChunkUploaded&&d.bind("ChunkUploaded",function(b,d,e){a.$parent.$apply(function(a){a[c.ngPlChunkUploaded](b,d,e)})}),c.ngPlUploadComplete&&d.bind("UploadComplete",function(b,d){a.$parent.$apply(function(a){a[c.ngPlUploadComplete](b,d)})}),c.ngPlUploadError&&d.bind("Error",function(b,d){a.$parent.$apply(function(a){a[c.ngPlUploadError](b,d)})}),c.ngPlUploadInstance&&(a.ngPlUploadInstance=d)}}}])}();